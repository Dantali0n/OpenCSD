[![pipeline status](https://gitlab.dantalion.nl:4443/vrije-universiteit-vu-/qemu-csd/badges/master/pipeline.svg)](https://gitlab.dantalion.nl:4443/vrije-universiteit-vu-/qemu-csd/commits/master)
[![coverage report](https://gitlab.dantalion.nl:4443/vrije-universiteit-vu-/qemu-csd/badges/master/coverage.svg)](https://gitlab.dantalion.nl:4443/vrije-universiteit-vu-/qemu-csd/commits/master)
# QEMU-CSD



### Project goals

* Perform read / write requests on ZNS SSD in QEMU.
* Setup Github repository and bi-directional mirroring.
* Read paper.

### Directory structure

* qemucsd - project source files
* cmake - small cmake snippets to enable various features
* dependencies - project dependencies
* docs - doxygen generated source code documentation
* documentation - project documentation written in LaTeX
* playground - small toy examples or other experiments
* [python](python/README.md) - python scripts to aid in visualization or measurements
* tests - unit tests and possibly integration tests

### Modules

| Module     | Optional | Task                                               |
|------------|----------|----------------------------------------------------|
| arguments  | Yes      | Parse commandline arguments to relevant components |

#### Dependencies

This project requires quite some dependencies, the
majority will be compiled by the project itself and installed
into the build directory. Anything that is not automatically
compiled and linked is shown below.

* General
    * compiler with c++17 support
    * cmake 3.13 or higher
* Windows specific
    * Visual Studio 2019 community
    * cygwin
* Documentation
    * doxygen
    * LaTeX
* Code Coverage
    * ctest
    * lcov
    * gcov
* Continuous Integration
    * valgrind
* Python scripts
    * python 3.x
    * virtualenv
* QEMU
    * librdmacm
    * libibverbs
    * libibumad

The following dependencies are automatically compiled. Dependencies are preferably
linked statically due to the nature of this project. However, for several dependencies
this is not possible due to various reason. For Boost, it is because the unit test
framework can not be statically linked (easily):

| Dependency                                                         | Version     |
|--------------------------------------------------------------------|-------------|
| [backward](https://github.com/bombela/backward-cpp)                | 1.5         |
| [booost](https://www.boost.org/)                                   | 1.74.0      |
| [libbpf](https://github.com/libbpf/libbpf)                         | 0.3         |
| [qemu](https://www.qemu.org/)                                      | 5.2.0       |

#### Setup

Building tools and dependencies is done by simply executing the following commands
from the root directory.

```shell script
git submodule update --init --recursive
mkdir build
cd build
cmake ..
cmake --build .
cmake .. # this prevents re-compiling dependencies on every next make command
source qemu-csd/activate.sh
# run commands and tools as you please
deactivate
```

Additionally, any python based tools and graphs are generated by execution these
additional commands from the root directory. Ensure the previous environment has
been deactivated.

```shell script
virtualenv -p python3 python
cd python
source bin/activate
pip install -r requirements.txt
```

#### Licensing

Some files are licensed under a variety of different licenses please see
specific source files for licensing details.

#### References

* [zoned storage ZNS SSDs introduction](https://zonedstorage.io/introduction/zns/)
* [NVMe ZNS command set 1.0 ratified TP](https://nvmexpress.org/wp-content/uploads/NVM-Express-1.4-Ratified-TPs-1.zip)
* [Getting started with ZNS in QEMU](https://www.snia.org/educational-library/getting-started-nvme-zns-qemu-2020)

#### Ideas

#### Snippets

Launch QEMU
```shell
qemu-img create -f raw znsssd.img 0
qemu-system-x86_64 -name qemucsd -m 4G -machine -cpu Haswell -smp 2 -hda ./arch-qemucsd.qcow2 \
-net user,hostfwd=tcp::7777-:22,hostfwd=tcp::2222-:2000 -net nic \
-drive file=/znsssd.img,id=mynvme,format=raw,if=none -device nvme,drive=mynvme,serial=deadbeef,\
logical_block_size=4096,physical_block_size=4096,zoned=true,zone_size=128,zone_capacity=128,\
max_open=0,max_active=0,zone_apped_size_limit=128,zone_descr_ext_size=64,zone_file=./zone_meta 
```
